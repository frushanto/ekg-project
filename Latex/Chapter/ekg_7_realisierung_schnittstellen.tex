%!TEX root =  ..\ekg_7_projektbericht.tex

%EKG-7 Realisierung/Schnittstellen

\subsection{Schnittstellen}


%TODO Verweis auf Kapitel UART zu Bildschirm einfügen
\subsubsection{Schnittstelle zum Bluetooth Modul + DMA}

Das verwendete Bluetooth Modul HC-05 wird über UART angesprochen. Die Baudrate ist dabei flexibel konfigurierbar. Das Modul öffnet auf dem verbundenem Smartphone oder Laptop einen virtuellen COM-Port, an welchen es alle ihm übertragenen Daten weiterleitet. Seitens der MCU wird das Hardware-Modul USCI\_A1 verwendet, welches mit Ausnahme der Basisadresse identisch zu USCI\_A0 in Kapitel ??? initialisiert wird. \\

Um beim versenden der Nachrichten keine Verzögerung oder zusätzliche CPU Last zu verursachen, wird Direct Memory Acces (DMA) verwendet. Das DMA-Modul kann nach korrekter Initialisierung automatische Daten im Hintergrund in das TX Register des UART Moduls kopieren. Hierfür muss im DMA Modul der Transfermodus Single Transfer eingestellt werden. Weitere benötigte Konfigurationen sind Byte-to-Byte Transfer, die Quelladresse, die Zieladresse und die Datengröße. Als Trigger um das nächste Byte zu übertragen ist das Interrupt Flag UCA1TXIFG zu wählen, welches immer dann aktiv ist, wenn das UART Modul bereit ist ein weiteres Byte zu senden. Damit ein ganzer String gesendet werden kann, ist das DMA Modul auf ein Inkrementieren der Quelladresse nach jedem versendetem Byte einzustellen. Somit wird nach Aktivierung des Moduls durch setzen des DMAEN Bits ein kompletter String im Hintergrund Byte für Byte versendet, bis die vorgegebene Datengröße abgearbeitet ist und das DMAEN Bit automatisch zurückgesetzt wird. Die CPU selbst wird dabei jeweils nur für zwei Takte durch das DMA Modul unterbrochen und muss nicht auf den Abschluss jedes Sendevorgangs warten.